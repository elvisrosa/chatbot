<div class="chat-area" *ngIf="activeContact?.id">
    <div class="chat-header">
        <div class="chat-contact-info">
            <div class="back-button">
                <i class="material-icons">arrow_back</i>
            </div>
            <div class="contact-avatar">
                <img [src]="activeContact?.profilePicture || '../../../assets/svgs/user.svg'"
                    [alt]="activeContact?.name" />
            </div>
            <div class="contact-details">
                <h3>{{ activeContact?.name }}</h3>
                <span class="status" [class.typing]="state === 'Escribiendo...'">{{ state }}</span>
            </div>
        </div>
        <div class="chat-actions">
            <i class="material-icons">videocam</i>
            <i class="material-icons">call</i>
            <i class="material-icons">more_vert</i>
        </div>
    </div>

    <span class="floating-date date-badge" *ngIf="isScrolling && currentDateDisplay">
        {{ currentDateDisplay | uppercase }}
    </span>

    <div *ngIf="!isPending" #messagesContainer class="messages-container" (scroll)="onScroll()">
        <ng-container *ngFor="let group of messages">

            <div class="messages-date-header date-badge" #dateHeader>
                {{ group.date | dateformat | uppercase }}
            </div>

            <div *ngFor="let message of group.messages; trackBy: trackByMessageId" class="message-wrapper"
                [class.outgoing]="message.to === activeContact?.id" #messageElement>
                <div class="messages-date invisible-date-header" #dateHeader>{{ message.timestamp | dateformat }}</div>
                <div class="message">
                    <div class="message-options" (click)="toggleMessageOptions(message)">
                        <i class="material-icons message-options-icon">expand_more</i>
                        <div class="message-options-menu" [class.show]="">
                            <div class="menu-option">
                                <i class="material-icons">reply</i>
                                <span>Responder</span>
                            </div>
                            <div class="menu-option">
                                <i class="material-icons">forward</i>
                                <span>Reenviar</span>
                            </div>
                            <div class="menu-option">
                                <i class="material-icons">star</i>
                                <span>Destacar</span>
                            </div>
                            <div class="menu-option">
                                <i class="material-icons">content_copy</i>
                                <span>Copiar</span>
                            </div>
                            <div class="menu-option delete">
                                <i class="material-icons">delete</i>
                                <span>Eliminar</span>
                            </div>
                        </div>
                    </div>
                    <div class="message-content">
                        {{ message.content?.body }}
                    </div>

                    <div class="message-meta">
                        <span class="message-time">{{ message.timestamp | date: 'hh:mm a' }}</span>
                        <i class="material-icons status-icon">
                            {{ util.getStatusIcon(message.status || '') }}
                        </i>
                    </div>
                </div>
            </div>
        </ng-container>
    </div>

    <!--<div *ngIf="false" class="messages-container pending-chat">
        <ng-container *ngFor="let group of messages">
            <div class="messages-date-header date-badge" #dateHeader>
                {{ group.date | dateformat | uppercase }}
            </div>
            <div *ngFor="let message of group.messages; trackBy: trackByMessageId" class="message-wrapper"
                [class.outgoing]="message.to === activeContact?.id" #messageElement>
                <div class="messages-date invisible-date-header" #dateHeader>{{ message.timestamp | dateformat }}</div>
                <div class="message pending-message">
                    <div class="message-content">{{ message.content.body }}</div>
                    <div class="message-meta">
                        <span class="message-time">{{ message.timestamp | date: 'hh:mm a'}}</span>
                    </div>
                </div>
            </div>
        </ng-container>
        <div class="pending-banner">
            <i class="material-icons">person_add</i>
            <span>{{ activeContact?.name }} te ha enviado una solicitud de contacto</span>

            <div class="pending-actions-compact">
                <button class="reject-btn-compact" (click)="changeStatus('reject')">
                    <i class="material-icons">close</i>
                    Rechazar
                </button>
                <button class="accept-btn-compact" (click)="changeStatus('contact')">
                    <i class="material-icons">check</i>
                    Aceptar
                </button>
            </div>
        </div>
    </div>-->

    <div class="chat-input-area" [class.disabled]="isPending">
        <div class="input-actions">
            <i class="material-icons">emoji_emotions</i>
            <i class="material-icons">attach_file</i>
        </div>
        <div class="message-input" *ngIf="!isPending && !limitMessageSendPending">
            <input #messageInput type="text" placeholder="Escribe un mensaje" [(ngModel)]="message.content"
                [disabled]="isPending" (keyup.enter)="onSendMessage()" (input)="onTyping()" />
        </div>
        <div class="send-button" (click)="onSendMessage()" *ngIf="!isPending">
            <i class="material-icons">{{ newMessage ? 'send' : 'mic' }}</i>
        </div>

        <div *ngIf="isPending || limitMessageSendPending" class="pending-input-message">
            <i class="material-icons">lock</i>
            <span> {{ getMessageBlocked() }} </span>
        </div>
    </div>
</div>

<ng-container *ngIf="!activeContact?.id">
    Descarga la App disponible en la Play Store
</ng-container>