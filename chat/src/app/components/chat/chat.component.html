<div class="chat-area" *ngIf="activeContact?.id">
    <div class="chat-header">
        <div class="chat-contact-info">
            <div class="back-button">
                <i class="material-icons">arrow_back</i>
            </div>
            <div class="contact-avatar">
                <img [src]="activeContact?.profilePicture || '../../../assets/svgs/user.svg'"
                    [alt]="activeContact?.name" />
            </div>
            <div class="contact-details">
                <h3>{{ activeContact?.name }}</h3>
                <span class="status" [class.typing]="state === 'Escribiendo...'">{{ state }}</span>
            </div>
        </div>
        <div class="chat-actions">
            <i class="material-icons">search</i>
            <i class="material-icons">videocam</i>
            <i class="material-icons">call</i>
            <!--<i class="material-icons" (click)="toggleMenuHeader($event)">more_vert</i>
            <app-message-options [options]="optionsHeader" [showMenu]="showMenuHeader" (optionClicked)="handleMenuAction($event)"
                (backdropClicked)="closeMenuHeader()"></app-message-options>-->
        </div>
    </div>

    <span class="floating-date date-badge" *ngIf="isScrolling && currentDateDisplay">
        {{ currentDateDisplay | uppercase }}
    </span>

    <div *ngIf="!isPending" #messagesContainer class="messages-container" (scroll)="onScroll()">
        <ng-container *ngFor="let group of messages">

            <div class="messages-date-header date-badge" #dateHeader>
                {{ group.date | dateformat | uppercase }}
            </div>

            <div *ngFor="let message of group.messages; trackBy: trackByMessageId" class="message-wrapper"
                [class.outgoing]="message.to === activeContact?.id" #messageElement [attr.data-message-id]="message.id">
                <div class="messages-date invisible-date-header" #dateHeader>{{ message.timestamp | dateformat }}</div>
                <div class="message">
                    <!--<div class="message-options" (click)="toggleMessageOptions(message)">
                        <i class="material-icons message-options-icon" (click)="toggleMenu($event)">expand_more</i>
                        <app-message-options [options]="options" [showMenu]="showMenu"
                            (optionClicked)="handleMenuAction($event)"
                            (backdropClicked)="closeMenu()"></app-message-options>
                    </div>-->
                    <div class="message-content">
                        {{ message.content?.body }}
                    </div>

                    <div class="message-meta">
                        <span class="message-time">{{ message.timestamp | date: 'shortTime' }}</span>
                        <i class="material-icons status-icon"
                            [ngStyle]="{color: message.status === 'sent' ? 'gray' : '#5b68f2'}">
                            {{ util.getStatusIcon(message.status || '') }}
                        </i>
                    </div>

                    <div class="message-options-container message-options-icon">
                        <app-message-options [options]="options" [triggerIcon]="'expand_more'" [width]="200"
                            [bgColor]="isDarkMode ? '#2a2a2a' : '#ffffff'"
                            [textColor]="isDarkMode ? '#f5f5f5' : '#333333'"
                            [iconColor]="isDarkMode ? '#b0b3b8' : '#555555'"
                            [triggerBgColor]="isDarkMode ? 'rgba(50, 50, 50, 0.9)' : 'rgba(255, 255, 255, 0.9)'"
                            [triggerColor]="isDarkMode ? '#b0b3b8' : '#555555'"
                            [boxShadow]="isDarkMode ? '0 2px 10px rgba(0, 0, 0, 0.3)' : '0 2px 10px rgba(0, 0, 0, 0.2)'"
                            (optionSelected)="handleMessageOption($event, message)" #optionsModal></app-message-options>
                    </div>
                </div>
            </div>
        </ng-container>
    </div>

    <!--<div *ngIf=" false" class="messages-container pending-chat">
                            <ng-container *ngFor="let group of messages">
                                <div class="messages-date-header date-badge" #dateHeader>
                                    {{ group.date | dateformat | uppercase }}
                                </div>
                                <div *ngFor="let message of group.messages; trackBy: trackByMessageId"
                                    class="message-wrapper" [class.outgoing]="message.to === activeContact?.id"
                                    #messageElement>
                                    <div class="messages-date invisible-date-header" #dateHeader>{{ message.timestamp |
                                        dateformat }}</div>
                                    <div class="message pending-message">
                                        <div class="message-content">{{ message.content.body }}</div>
                                        <div class="message-meta">
                                            <span class="message-time">{{ message.timestamp | date: 'hh:mm a'}}</span>
                                        </div>
                                    </div>
                                </div>
                            </ng-container>
                            <div class="pending-banner">
                                <i class="material-icons">person_add</i>
                                <span>{{ activeContact?.name }} te ha enviado una solicitud de contacto</span>

                                <div class="pending-actions-compact">
                                    <button class="reject-btn-compact" (click)="changeStatus('reject')">
                                        <i class="material-icons">close</i>
                                        Rechazar
                                    </button>
                                    <button class="accept-btn-compact" (click)="changeStatus('contact')">
                                        <i class="material-icons">check</i>
                                        Aceptar
                                    </button>
                                </div>
                            </div>
                    </div>-->

    <div class="chat-input-area" [class.disabled]="isPending">
        <div class="input-actions">
            <i class="material-icons">emoji_emotions</i>
            <i class="material-icons">attach_file</i>
        </div>
        <div class="message-input" *ngIf="!isPending && !limitMessageSendPending">
            <input #messageInput type="text" placeholder="Escribe un mensaje" [(ngModel)]="message.content"
                [disabled]="isPending" (keyup.enter)="onSendMessage()" (input)="onTyping()" />
        </div>
        <div class="send-button" (click)="onSendMessage()" *ngIf="!isPending">
            <i class="material-icons">{{ newMessage ? 'send' : 'mic' }}</i>
        </div>

        <div *ngIf="isPending || limitMessageSendPending" class="pending-input-message">
            <i class="material-icons">lock</i>
            <span> {{ getMessageBlocked() }} </span>
        </div>
    </div>
</div>

<ng-container *ngIf="!activeContact?.id">
    Descarga la App disponible en la Play Store
</ng-container>